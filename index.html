<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Images from Blob Storage</title>
</head>
<body>

<div id="imageContainer"></div>
<button onclick="loadNextImage()">Next Image</button>

<script>
    // Replace these values with your own Azure Storage account information
    const accountName = 'sranephoto';
    const containerName = 'lehladak';
    const sasToken = '?sv=2022-11-02&ss=bfqt&srt=sco&sp=rwdlacupiytfx&se=2023-12-16T20:17:41Z&st=2023-12-16T12:17:41Z&spr=https&sig=IX98DmOJkEOMokoYRTzHhkEju6lMhdRxc%2By19t4uWJc%3D';

    // Blob storage endpoint
    const endpoint = `https://${accountName}.blob.core.windows.net`;

    // Array to store image names or blob IDs
    let imageNames = [];

    // Current index to track the displayed image
    let currentIndex = 0;

    function fetchBlobList() {
        const apiUrl = `${endpoint}/${containerName}?restype=container&comp=list&${sasToken}`;

        fetch(apiUrl)
            .then(response => response.text())
            .then(data => {
                console.log('Fetched blob list:', data);

                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(data, 'application/xml');
                const blobs = xmlDoc.getElementsByTagName('Blob');

                for (let i = 0; i < blobs.length; i++) {
                    const blobName = blobs[i].getElementsByTagName('Name')[0].textContent;
                    imageNames.push(blobName);
                }

                console.log('Image names:', imageNames);

                // Load the first image when the page loads
                loadNextImage();
            })
            .catch(error => console.error('Error fetching blob list:', error));
    }

    function loadNextImage() {
        if (currentIndex < imageNames.length) {
            const imageUrl = `${endpoint}/${containerName}/${imageNames[currentIndex]}${sasToken}`;
            console.log('Loading image:', imageUrl);

            const imageElement = document.createElement('img');
            imageElement.src = imageUrl;
            imageElement.style.maxWidth = '100%';

            document.getElementById('imageContainer').innerHTML = '';
            document.getElementById('imageContainer').appendChild(imageElement);

            currentIndex++;
        } else {
            alert('All images have been displayed.');
        }
    }

    // Fetch the list of blobs when the page loads
    window.onload = fetchBlobList;
</script>

</body>
</html>
